<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Página de acesso ao sistema">
  <title>Acesso - Sistema</title>
  <link rel="stylesheet" href="../css/login.css" />
  <link rel="icon" href="../images/favicon.ico" type="image/x-icon" />
</head>
<body>

  <div class="login-wrapper">
    <div class="container">
      <h1>Acesso ao Sistema</h1>

      <form id="form-login" novalidate>
        <div id="mensagem-erro" class="mensagem-erro" style="display: none;"></div>
        
        <div class="input-container">
          <label for="email">E-mail:</label>
          <input type="email" id="email" name="email" required 
                 placeholder="Digite seu e-mail"
                 autocomplete="username" />
        </div>

        <div class="input-container">
          <label for="senha">Senha:</label>
          <input type="password" id="senha" name="senha" required 
                 placeholder="Digite sua senha"
                 minlength="3"
                 autocomplete="current-password" />
        </div>

        <button type="submit" class="botao-com-video" id="Acessar" aria-label="Acessar sistema">
          <video autoplay muted loop playsinline class="video-hover" preload="auto" aria-hidden="true">
            <source src="../videos/login.mp4" type="video/mp4">
          </video>
          <span class="texto-botao">Acessar</span>
        </button>
      </form>

      <div class="links-container">
        <a href="../html/esqueci_senha.html" class="link-acesso">Esqueci minha senha</a>
        <p>Não tem uma conta? <a href="../html/cadastro.html" class="link-acesso">Cadastre-se</a></p>
      </div>
    </div>
  </div>

  <noscript>
    <p class="erro">Por favor, habilite o JavaScript para acessar o sistema.</p>
  </noscript>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      console.log("login.js carregado!");

      const form = document.getElementById("form-login");
      const mensagemErro = document.getElementById("mensagem-erro");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        
        const email = document.getElementById("email").value.trim();
        const senha = document.getElementById("senha").value;

        try {
          const response = await fetch("https://nfbnk2nku9.execute-api.us-east-1.amazonaws.com/dev/loginCliente", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ email, senha })
          });

          const data = await response.json();

          if (!data.success) {
            mensagemErro.style.display = "block";
            mensagemErro.textContent = "Erro: " + data.message;
            return;
          }

          // Sucesso
          window.location.href = "../html/home.html"; // redireciona para a área logada

        } catch (err) {
          console.error("Erro no login:", err);
          mensagemErro.style.display = "block";
          mensagemErro.textContent = "Erro de conexão com o servidor.";
        }
      });
    });
  </script>

</body>
</html>
